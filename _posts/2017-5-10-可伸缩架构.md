---
layout:     post
title:      可伸缩架构设计
subtitle:   如何设计一个可伸缩的架构？
date:       2017-05-07
author:     Joker
header-img: img/post-bg-debug.png
catalog: true
tags:
    - 大型网站
    - 架构
    - 可伸缩
---

> 不同功能进行物理分离实现伸缩

- 纵向分离
  - 通过物理上分离不同的层
- 横向分离
  - 通过业务模块进行分离
- 单一功能通过集群实现伸缩

------

# 伸缩性设计

- HTTP重定向负载均衡

- DNS域名解析负载均衡

  - 大型网站系统总是部分使用这种方法，以此作为第一级的负载均衡的手段

  - | 优点   | 将负载均衡交给了DNS，省去的网站管理维护负载均衡服务的麻烦，同时还能解析地理位置的域名解析，加速访问 |
    | ---- | ---------------------------------------- |
    | 缺点   | DNS多级缓存，每一级DNS都会缓存A记录，如果下线某台服务器后，即使修改了DNS的A记录其生效时间也需要很长的时间 |

- 反向代理负载均衡

  - | 优点   | 和反向代理服务器集成在一起，部署简单         |
    | ---- | -------------------------- |
    | 缺点   | 反向代理时所有请求和响应的中转，其性能可能会成为瓶颈 |

- IP负载均衡

- 链路层负载均衡

  - 三角传输模式时大型网站使用最广的均衡手段

------

# 分布式缓存集群的伸缩性

# 较为简单的路由算法

>  例如：一个缓存集群原本包含三个NODE1，NODE2，NODE3三个节点，先扩容至4台，放入Key值为BEIJING的字段，对应HASH值为490643，除4余2，所以放入NODE2节点，原本放在NODE1节点，命中失败。

> 解决方案：在网站访问量最小的时候扩容服务器集群，通过模拟请求的形式对缓存预热

# 一致性HASH算法

此算法能够减小扩容对缓存命中的影响。

------

# 关系数据库的伸缩性

> 大型网站的数据库大都在做了主从分离后，根据业务划分为不同的数据库。数据库分库后的制约条件时无法进行跨库的JOIN操作

Cobar能够利用Mysql的同步功能进行数据的迁移

------

# NOSQL数据库的伸缩性

> 以HBase为例

nHRegion->1HRegionServer

nHRegionServer->1HMaster

nHMaster->1Zookeeper

可通过扩充HMaster服务器来实现伸缩